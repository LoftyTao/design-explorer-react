- name: Create Electron main process file
        run: |
          $content = @"

          const { app, BrowserWindow, protocol, net, shell } = require('electron');
          const path = require('path');
          const { pathToFileURL } = require('url');

          protocol.registerSchemesAsPrivileged([
            { scheme: 'app', privileges: { secure: true, standard: true, supportFetchAPI: true, corsEnabled: true } }
          ]);

          function createWindow() {
            const win = new BrowserWindow({
              width: 1400,
              height: 900,
              webPreferences: {
                nodeIntegration: false,
                contextIsolation: true,
                webSecurity: false
              }
            });
            
            win.webContents.setWindowOpenHandler(({ url }) => {
              if (url.startsWith('https:') || url.startsWith('http:')) {
                shell.openExternal(url);
                return { action: 'deny' };
              }
              return { action: 'allow' };
            });

            win.webContents.on('will-navigate', (event, url) => {
              if (url.startsWith('https:') || url.startsWith('http:')) {
                event.preventDefault();
                shell.openExternal(url);
              }
            });
            
            win.loadURL('app://design-explorer/index.html');
          }

          app.whenReady().then(() => {
            protocol.handle('app', (request) => {
              const url = new URL(request.url);
              let pathname = url.pathname;
              
              if (pathname.startsWith('/')) {
                pathname = pathname.slice(1);
              }
              
              const filePath = path.join(__dirname, 'dist', decodeURIComponent(pathname));
              return net.fetch(pathToFileURL(filePath).toString());
            });

            createWindow();
          });

          app.on('window-all-closed', () => {
            if (process.platform !== 'darwin') app.quit();
          });
          "@
          $content | Out-File -FilePath electron-main.cjs -Encoding utf8
